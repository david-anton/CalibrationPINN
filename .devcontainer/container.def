Bootstrap: docker
From: nvidia/cuda:12.1.1-cudnn8-devel-ubuntu22.04
# From: nvidia/cuda:11.8.0-cudnn8-devel-ubuntu20.04

# %setup

%files
    app/requirements.txt /data/requirements.txt
    app /data/app

# %app*

%post
    # Configure environment (only for build time)
    export DATA_DIR=/data

    # Install fenicsx as Ubuntu package
    apt-get update
    apt-get install -y software-properties-common
    add-apt-repository ppa:fenics-packages/fenics
    apt-get update
    DEBIAN_FRONTEND=noninteractive apt-get install -y fenicsx

    # Install Python requirements
    pip3 install --upgrade pip
    pip3 install -r $DATA_DIR/requirements.txt

    # Clean up
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

    # Set permissions
    chmod 777 -R $DATA_DIR 

# %test

%environment
    export DATA_DIR=/data

# %startscript
# %runscript
# %labels
# %help
