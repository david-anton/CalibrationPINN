Bootstrap: docker
From: nvidia/cuda:12.1.1-cudnn8-devel-ubuntu22.04

# %setup

%files
    app/requirements.txt /data/requirements.txt

# %app*

%post
    # Configure environment (only for build time)
    export DATA_DIR=/data

    # Install base utilities
    apt-get update
    apt-get install -y \
    nano

    # Install packages for gmsh
    apt-get -y install -y \
    libgl1 
    # apt-get -y install \
    # libglu1 \
    # libxcursor-dev \
    # libxft2 \
    # libxinerama1 \
    # libfltk1.3-dev \ 
    # libfreetype6-dev  \
    # libgl1-mesa-dev \

    # Install fenicsx as Ubuntu package
    apt-get update
    apt-get install -y software-properties-common
    add-apt-repository ppa:fenics-packages/fenics
    apt-get update
    DEBIAN_FRONTEND=noninteractive apt-get install -y fenicsx

    # Install Python requirements
    pip3 install --upgrade pip
    pip3 install -r $DATA_DIR/requirements.txt
    pip3 install --pre torch --extra-index-url https://download.pytorch.org/whl/nightly/cpu

    # Clean up
    apt-get clean && \
    rm -rf /var/lib/apt/lists/* 

    # Set permissions
    chmod 777 -R $DATA_DIR 

# %test

%environment
    export DATA_DIR=/data

# %startscript
# %runscript
# %labels
# %help
